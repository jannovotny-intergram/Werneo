/*! werneo - v0.1.0 - 2016-05-10
* Copyright (c) 2016 ; Licensed  */
function Werneo(){this.plugins=[],this.pluginNames=[],this.registerPlugin=function(name,plugin){this.plugins[name]=plugin,this.pluginNames.push(name)},this.invoke=function(){var i;for(i=0;i<this.pluginNames.length;i++)this.plugins[this.pluginNames[i]].invoke()}}function WerneoDropdowns(){this.dropdownTriggers=null,this.dropdownOptions=null,WerneoDropdowns.prototype.toggle=function(dropdown){var i,siblings=dropdown.parentNode.childNodes;for(dropdown.classList.toggle("active"),i=0;i<siblings.length;i++)1===siblings[i].nodeType&&siblings[i]!==dropdown&&siblings[i].classList.toggle("active")},WerneoDropdowns.prototype.select=function(option){for(var dropdown=option;null!==dropdown.parentElement&&!1===dropdown.classList.contains("dropdown");)dropdown=dropdown.parentElement;for(var next=option.nextSibling;null!==next&&1!==next.nodeType;)next=next.nextSibling;if(null!==next&&next.classList.contains("dropdown-level"))next.classList.toggle("active");else{var i,activatedElements=dropdown.querySelectorAll(".dropdown-option,.dropdown-value,.dropdown-level,.dropdown-list,.dropdown-handle");if(activatedElements.length>0)for(i=0;i<activatedElements.length;i++)activatedElements[i].classList.remove("active");option.classList.add("active");var newDropdownValue="undefined"==typeof option.dataset.label?option.innerHTML:option.dataset.label;if(dropdown.querySelector(".dropdown-value").innerHTML=newDropdownValue,"undefined"!=typeof dropdown.dataset.inputId){var associatedInput=document.querySelector("#"+dropdown.dataset.inputId);if(associatedInput.value=option.dataset.value,null!==associatedInput.onchange&&associatedInput.onchange(),"true"===dropdown.dataset.submit){for(var form=dropdown;null!==form.parentElement&&"FORM"!==form.nodeName;)form=form.parentElement;null!==form&&form.submit()}}}},WerneoDropdowns.prototype.handle=function(){var i,_this=this;if(_this.dropdownTriggers=document.querySelectorAll(".dropdown-handle,.dropdown-value"),_this.dropdownTriggers.length>0)for(i=0;i<_this.dropdownTriggers.length;i++)_this.dropdownTriggers[i].addEventListener("click",function(){_this.toggle(this)});if(_this.dropdownOptions=document.querySelectorAll(".dropdown-option"),_this.dropdownOptions.length>0)for(i=0;i<_this.dropdownOptions.length;i++)_this.dropdownOptions[i].addEventListener("click",function(){_this.select(this)})},WerneoDropdowns.prototype.invoke=function(){var _this=this;document.addEventListener("DOMContentLoaded",function(){_this.handle()})}}function WerneoDynaFilter(){this.dynaFilters=null,WerneoDynaFilter.prototype.toggle=function(trigger,triggers,target){var i;for(i=0;i<triggers.length;i++)triggers[i].classList.remove("active");if(null!==trigger.dataset["class"]){if(""!==trigger.dataset["class"]){var itemsToHide=target.querySelectorAll(".dynafilter-item:not(."+trigger.dataset["class"]+")");for(i=0;i<itemsToHide.length;i++)itemsToHide[i].classList.add("dynafilter-hidden")}var itemsToShow=target.querySelectorAll(".dynafilter-item"+(""!==trigger.dataset["class"]?"."+trigger.dataset["class"]:""));for(i=0;i<itemsToShow.length;i++)itemsToShow[i].classList.remove("dynafilter-hidden")}trigger.classList.add("active")},WerneoDynaFilter.prototype.handle=function(){var i,j,_this=this;if(_this.dynaFilters=document.querySelectorAll(".dynafilter"),_this.dynaFilters.length>0)for(i=0;i<_this.dynaFilters.length;i++){var target=document.querySelector(_this.dynaFilters[i].dataset.target),triggers=_this.dynaFilters[i].querySelectorAll(".dynafilter-trigger");if(null!==target&&triggers.length>0)for(j=0;j<triggers.length;j++)triggers[j].addEventListener("click",function(){_this.toggle(this,triggers,target)})}},WerneoDynaFilter.prototype.invoke=function(){var _this=this;document.addEventListener("DOMContentLoaded",function(){_this.handle()})}}function WerneoFlashMessages(){this.queue=null,this.id=1,WerneoFlashMessages.prototype.dismiss=function(id){var _this=this;_this.queue.querySelector("#flash-message-"+id).classList.remove("active")},WerneoFlashMessages.prototype.show=function(id){var _this=this;_this.queue.querySelector("#flash-message-"+id).classList.add("active"),_this.queue.querySelector("#flash-message-"+id+"-close").addEventListener("click",function(){_this.dismiss(id)})},WerneoFlashMessages.prototype.getMessageHtml=function(content,type,id){var html='<div class="'+type+' flash-message" id="flash-message-'+id+'">';return html+=content,html+='<span class="close" id="flash-message-'+id+'-close">&times;</span>',html+="</div>"},WerneoFlashMessages.prototype.createMessage=function(content,type){var _this=this,id=_this.id++;_this.queue.innerHTML=_this.getMessageHtml(content,type,id)+_this.queue.innerHTML,setTimeout(function(){_this.show(id)},100),setTimeout(function(){_this.dismiss(id)},5100)},WerneoFlashMessages.prototype.invoke=function(){var _this=this;null===document.getElementById("flash-message-queue")&&(document.querySelector("body").innerHTML+='<div id="flash-message-queue" class="flash-message-queue"></div>'),_this.queue=document.getElementById("flash-message-queue")}}function WerneoGallery(){this.galleries=null,WerneoGallery.prototype.create=function(gallery){var i,j,galleryWidth=gallery.offsetWidth,gutter=0,items=gallery.querySelectorAll(".gallery-item"),images=[],lowest=-1,rows=[],rowIndex=0;if("undefined"!=typeof gallery.dataset.gutter&&null!==gallery.dataset.gutter&&(gutter=parseInt(gallery.dataset.gutter)),items.length>0)for(i=0;i<items.length;i++)images[i]=items[i].querySelector("img"),(0>lowest||lowest>images[i].naturalHeight)&&(lowest=images[i].naturalHeight);if(items.length>0)for(i=0;i<items.length;i++){"undefined"==typeof rows[rowIndex]&&(rows[rowIndex]={contentWidth:0,items:[]});var ratio=images[i].naturalWidth/images[i].naturalHeight,width=lowest*ratio;items[i].style.height=lowest+"px",items[i].style.width=width+"px",rows[rowIndex].contentWidth+=width,rows[rowIndex].items.push(i),rows[rowIndex].contentWidth>galleryWidth&&rowIndex++}if(rows.length>0)for(i=0;i<rows.length;i++){var scaleRatio=galleryWidth/(rows[i].contentWidth+(rows[i].items.length-1)*gutter);if(console.log("r"+i+": "+(rows[i].contentWidth-galleryWidth)),rows[i].items.length>0){var counter=0;for(j=0;j<rows[i].items.length;j++){var scaledWidth=items[rows[i].items[j]].offsetWidth*scaleRatio,scaledHeight=items[rows[i].items[j]].offsetHeight*scaleRatio;console.log("w: "+items[rows[i].items[j]].offsetWidth+" -> "+scaledWidth+"px"),counter+=scaledWidth,items[rows[i].items[j]].style.height=scaledHeight+"px",items[rows[i].items[j]].style.width=scaledWidth+"px",items[rows[i].items[j]].style.marginBottom=gutter+"px"}console.log(counter)}}gallery.classList.add("showing")},WerneoGallery.prototype.handle=function(){var i,_this=this;if(_this.galleries=document.querySelectorAll(".gallery"),_this.galleries.length>0)for(i=0;i<_this.galleries.length;i++)_this.create(_this.galleries[i])},WerneoGallery.prototype.invoke=function(){var _this=this;window.addEventListener("load",function(){_this.handle()})}}var werneo=new Werneo;werneo.registerPlugin("dropdowns",new WerneoDropdowns),werneo.registerPlugin("dynaFilter",new WerneoDynaFilter),werneo.registerPlugin("flashMessages",new WerneoFlashMessages),werneo.registerPlugin("gallery",new WerneoGallery),werneo.invoke();